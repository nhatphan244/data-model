import requests
import pandas as pd

def fetch_overpass_data():
    # Overpass API URL
    url = "http://overpass-api.de/api/interpreter"
    
    # Your Overpass QL query
    query = """
    [out:csv("name")][timeout:2500];
    area["name"="Tỉnh Cà Mau"]->.searchArea;
    (
      way["highway"]["name"!~"Ấp|Hẻm|Ngõ|Ngách|Thôn|Tổ|Xóm|Làng|Khóm"](area.searchArea);
    );
    out;
    """

    # Sending the POST request to the Overpass API
    response = requests.post(url, data={'data': query})

    # Checking if the request was successful
    if response.status_code == 200:
        # Ensuring response is treated as UTF-8
        response.encoding = 'utf-8'
        return response.text
    else:
        return f"Failed to retrieve data: {response.status_code}, {response.text}"

def parse_to_dataframe(data):
    # Using pandas to read the CSV formatted string
    from io import StringIO
    df = pd.read_csv(StringIO(data), names=['street_name'])
    return df

# Call the function to fetch data and parse it into a DataFrame
result = fetch_overpass_data()
if not result.startswith('Failed'):
    dataframe = parse_to_dataframe(result)
    print(dataframe)
else:
    print(result)
