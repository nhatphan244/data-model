from datetime import datetime
import pandas as pd

# Example error messages dictionary
date_errors_message = {
    'JoinDate': 'Ngày tham gia không hợp lệ',
    'EndDate': 'Ngày kết thúc không hợp lệ'
}

def validate_date(column_name, date_value):
    # Get the current date
    current_date = datetime.now().date()
    
    # If the date value is empty or NaN, assume it's valid
    if pd.isna(date_value) or date_value == '':
        return True, ""

    # Try to parse the date string into a datetime object
    if isinstance(date_value, str):
        try:
            date_obj = datetime.strptime(date_value, '%d/%m/%Y').date()
        except ValueError:
            return False, date_errors_message[column_name] + " (định dạng phải là dd/mm/yyyy)."
    elif isinstance(date_value, datetime):
        date_obj = date_value.date()
    else:
        return False, date_errors_message[column_name] + " (định dạng phải là dd/mm/yyyy)."

    # Perform the comparison using date objects
    if column_name in ['JoinDate', 'EndDate']:
        if date_obj >= current_date:
            return True, ""
        else:
            return False, date_errors_message[column_name] + " (không được là ngày trong quá khứ)."

    # If none of the above conditions are met, return True
    return True, ""
